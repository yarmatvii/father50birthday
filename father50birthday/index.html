<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>Happy Birthday</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@600;800&display=swap" rel="stylesheet">
    <style>
        * {
            box-sizing: border-box
        }

        html,
        body {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            overscroll-behavior: none;
            touch-action: none;
            font-family: 'Orbitron', system-ui;
        }

        body {
            background: #050508;
            color: white
        }

        /* TAP OVERLAY */
        #tapOverlay {
            position: fixed;
            inset: 0;
            z-index: 999;
            background: rgba(5, 5, 8, 0.95);
            backdrop-filter: blur(20px);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }

        #tapOverlay div {
            font-size: clamp(3rem, 12vw, 6rem);
            font-weight: 800;
            letter-spacing: .2em;
            animation: tapPulse 1.5s ease-in-out infinite;
        }

        @keyframes tapPulse {

            0%,
            100% {
                transform: scale(1);
                opacity: 0.8
            }

            50% {
                transform: scale(1.1);
                opacity: 1
            }
        }

        #bg {
            position: fixed;
            inset: 0;
            z-index: 0;
            opacity: 0;
            pointer-events: none;
        }

        #bg::before {
            content: "";
            position: absolute;
            inset: -30%;
            background: linear-gradient(120deg, #ff00cc, #00ccff, #ffcc00);
            animation: bgmove 30s linear infinite;
            opacity: .14;
        }

        @keyframes bgmove {
            to {
                transform: rotate(360deg)
            }
        }

        #stage {
            position: fixed;
            inset: 0;
            z-index: 1;
        }

        .media {
            position: absolute;
            top: -40vh;
            width: 32vw;
            max-width: 180px;
            aspect-ratio: 4/3;
            opacity: 0;
            transform: translate3d(0, 0, 0) scale(1.15);
            filter: drop-shadow(0 18px 36px rgba(0, 0, 0, .85)) blur(8px);
            pointer-events: none;
            cursor: pointer;
            transition: transform 0.2s, filter 0.6s;
        }

        .media.unlocked {
            filter: drop-shadow(0 18px 36px rgba(0, 0, 0, .85)) blur(0px);
        }

        .media:active {
            transform: translate3d(0, 0, 0) scale(0.92);
        }

        .media.unlocked:active {
            filter: drop-shadow(0 8px 16px rgba(255, 0, 204, .8)) blur(0px);
        }

        .media img,
        .media video {
            width: 100%;
            height: 100%;
            object-fit: cover
        }

        .media.animate {
            animation: fall 1400ms cubic-bezier(.2, .85, .25, 1) forwards;
        }

        @keyframes fall {
            to {
                top: var(--y);
                left: var(--x);
                transform: translate3d(0, 0, 0) scale(.95);
                opacity: 1;
            }
        }

        #hero {
            position: absolute;
            top: -50vh;
            left: 50%;
            width: 86vw;
            max-width: 380px;
            aspect-ratio: 4/3;
            opacity: 0;
            transform: translateX(-50%) scale(1.25);
            z-index: 10;
            cursor: pointer;
            transition: transform 0.2s, filter 0.2s;
        }

        #hero:active {
            transform: translateX(-50%) scale(0.96);
            filter: drop-shadow(0 12px 24px rgba(0, 204, 255, .9));
        }

        #hero img {
            width: 100%;
            height: 100%;
            object-fit: cover
        }

        #hero.animate {
            animation: fallHero 1600ms cubic-bezier(.2, .85, .25, 1) forwards;
        }

        @keyframes fallHero {
            to {
                top: 38%;
                transform: translateX(-50%) scale(1);
                opacity: 1;
            }
        }

        /* TAP HINT ON HERO */
        #tapHint {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: clamp(2rem, 8vw, 3.5rem);
            font-weight: 800;
            letter-spacing: .15em;
            color: white;
            text-shadow: 0 0 20px rgba(0, 204, 255, .8), 0 0 40px rgba(255, 0, 204, .6);
            pointer-events: none;
            opacity: 0;
            z-index: 11;
        }

        #tapHint.show {
            animation: hintPulse 2s ease-in-out infinite;
        }

        @keyframes hintPulse {

            0%,
            100% {
                opacity: 0.7;
                transform: translate(-50%, -50%) scale(1);
            }

            50% {
                opacity: 1;
                transform: translate(-50%, -50%) scale(1.15);
            }
        }

        #caption {
            position: absolute;
            top: 64%;
            left: 50%;
            transform: translateX(-50%);
            white-space: nowrap;
            font-weight: 800;
            letter-spacing: .12em;
            font-size: clamp(1.2rem, 5.5vw, 2rem);
            opacity: 0;
            z-index: 11;
        }

        #caption.animate {
            animation: captionIn 900ms ease-out forwards, glow 2.8s ease-in-out infinite 0.9s;
        }

        @keyframes captionIn {
            to {
                opacity: 1
            }
        }

        @keyframes glow {

            0%,
            100% {
                text-shadow: 0 0 10px #ff00cc
            }

            50% {
                text-shadow: 0 0 30px #00ccff
            }
        }

        #fireworks {
            position: fixed;
            inset: -25%;
            z-index: 12;
            pointer-events: none;
        }

        .spark {
            position: absolute;
            width: 6px;
            height: 6px;
            background: white;
            animation: spark 1600ms ease-out forwards;
        }

        @keyframes spark {
            to {
                transform: translate(var(--dx), var(--dy)) scale(0);
                opacity: 0
            }
        }

        #overlay {
            position: fixed;
            inset: 0;
            display: none;
            align-items: center;
            justify-content: center;
            background: rgba(0, 0, 0, .75);
            backdrop-filter: blur(14px);
            z-index: 100;
        }

        #overlayContent {
            width: 75vw;
            max-width: 520px;
            aspect-ratio: 4/3;
            position: relative;
            animation: overlayPop 0.4s cubic-bezier(.34, 1.56, .64, 1);
        }

        #overlayContent img,
        #overlayContent video {
            width: 100%;
            height: 100%;
            object-fit: contain;
            filter: drop-shadow(0 0 40px rgba(0, 204, 255, .6));
            animation: overlayGlow 2s ease-in-out infinite;
        }

        @keyframes overlayPop {
            from {
                transform: scale(0.8);
                opacity: 0
            }

            to {
                transform: scale(1);
                opacity: 1
            }
        }

        @keyframes overlayGlow {

            0%,
            100% {
                filter: drop-shadow(0 0 40px rgba(0, 204, 255, .6))
            }

            50% {
                filter: drop-shadow(0 0 60px rgba(255, 0, 204, .8))
            }
        }

        #close {
            position: absolute;
            top: -18px;
            right: -18px;
            width: 42px;
            height: 42px;
            background: #ff0055;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            cursor: pointer;
            transition: transform 0.2s;
            z-index: 101;
        }

        #close:active {
            transform: scale(0.9);
        }

        #refresh {
            position: absolute;
            bottom: 22px;
            left: 50%;
            transform: translateX(-50%);
            padding: 14px 32px;
            background: white;
            color: black;
            font-size: 1rem;
            display: none;
            z-index: 200;
            cursor: pointer;
            font-weight: 800;
            letter-spacing: .08em;
            transition: transform 0.2s, box-shadow 0.2s;
            box-shadow: 0 4px 20px rgba(255, 255, 255, .3);
        }

        #refresh:active {
            transform: translateX(-50%) scale(0.95);
            box-shadow: 0 2px 10px rgba(255, 255, 255, .5);
        }
    </style>
</head>

<body>
    <div id="tapOverlay">
        <div>НАТИСНИ</div>
    </div>
    <div id="bg"></div>
    <div id="stage"></div>
    <div id="tapHint">НАТИСНИ</div>
    <div id="fireworks"></div>
    <div id="overlay">
        <div id="overlayContent">
            <div id="close">✕</div>
        </div>
    </div>
    <div id="refresh">ПЕРЕЗАВАНТАЖИТИ</div>

    <!-- AUDIO (your local files) -->
    <audio id="bgm" src="confessa.mp3" loop></audio>
    <audio id="tap" src="tap.mp3"></audio>
    <audio id="fallSound" src="fall.mp3"></audio>
    <audio id="fwSound" src="fireworks.mp3"></audio>

    <script>
        const tapOverlay = document.getElementById('tapOverlay');
        const stage = document.getElementById('stage');
        const bg = document.getElementById('bg');
        const overlay = document.getElementById('overlay');
        const overlayContent = document.getElementById('overlayContent');
        const closeBtn = document.getElementById('close');
        const refreshBtn = document.getElementById('refresh');
        const tapHint = document.getElementById('tapHint');
        const bgm = document.getElementById('bgm');
        const tap = document.getElementById('tap');
        const fallSound = document.getElementById('fallSound');
        const fwSound = document.getElementById('fwSound');

        let remaining = 0;
        let unlocked = false;
        let started = false;

        // Predefined chaotic pile positions
        const pilePositions = [
            [1, 12], [9, 8], [19, 14], [29, 10], [41, 16], [53, 12], [65, 8], [77, 14],
            [5, 22], [15, 26], [25, 22], [37, 26], [49, 22], [61, 26], [73, 22],
            [1, 34], [13, 32], [23, 36], [35, 34], [47, 38], [59, 34], [71, 36],
            [7, 46], [19, 44], [31, 48], [43, 46], [55, 50], [67, 46], [79, 48],
            [3, 58], [15, 56], [27, 60], [39, 58], [51, 62], [63, 58], [75, 60],
            [9, 70], [21, 68], [33, 72], [45, 70], [57, 74], [69, 70],
            [5, 82], [19, 80], [33, 84], [47, 82], [61, 86], [75, 82],
            [-1, 42], [81, 40], [-3, 64], [83, 66], [1, 76], [79, 76],
            [11, 18], [23, 18], [35, 18], [47, 18], [59, 18], [71, 18],
            [13, 90], [45, 90], [77, 90],
            // manually added extra 6 positions
            [7, 60], [31, 72], [53, 80], [65, 50], [17, 40], [85, 20]
        ];

        // Mix of images and videos
        const mediaSources = [
            { url: "photos/photo (1).jpg", video: false },
            { url: "photos/photo (2).jpg", video: false },
            { url: "photos/photo (3).jpg", video: false },
            { url: "photos/photo (4).jpg", video: false },
            { url: "photos/photo (5).jpg", video: false },
            { url: "photos/photo (6).jpg", video: false },
            { url: "photos/photo (7).jpg", video: false },
            { url: "photos/photo (8).jpg", video: false },
            { url: "photos/photo (9).jpg", video: false },
            { url: "photos/photo (10).jpg", video: false },

            { url: "photos/photo (11).jpg", video: false },
            { url: "photos/photo (12).jpg", video: false },
            { url: "photos/photo (13).jpg", video: false },
            { url: "photos/photo (14).jpg", video: false },
            { url: "photos/photo (15).jpg", video: false },
            { url: "photos/photo (16).jpg", video: false },
            { url: "photos/photo (17).jpg", video: false },
            { url: "photos/photo (18).jpg", video: false },
            { url: "photos/photo (19).jpg", video: false },
            { url: "photos/photo (20).jpg", video: false },

            { url: "photos/photo (21).jpg", video: false },
            { url: "photos/photo (22).jpg", video: false },
            { url: "photos/photo (23).jpg", video: false },
            { url: "photos/photo (24).jpg", video: false },
            { url: "photos/photo (25).jpg", video: false },
            { url: "photos/photo (26).jpg", video: false },
            { url: "photos/photo (27).jpg", video: false },
            { url: "photos/photo (28).jpg", video: false },
            { url: "photos/photo (29).jpg", video: false },
            { url: "photos/photo (30).jpg", video: false },

            { url: "photos/photo (31).jpg", video: false },
            { url: "photos/photo (32).jpg", video: false },
            { url: "photos/photo (33).jpg", video: false },
            { url: "photos/photo (34).jpg", video: false },
            { url: "photos/photo (35).jpg", video: false },
            { url: "photos/photo (36).jpg", video: false },
            { url: "photos/photo (37).jpg", video: false },
            { url: "photos/photo (38).jpg", video: false },
            { url: "photos/photo (39).jpg", video: false },
            { url: "photos/photo (40).jpg", video: false },

            { url: "photos/photo (41).jpg", video: false },
            { url: "photos/photo (42).jpg", video: false },
            { url: "photos/photo (43).jpg", video: false },
            { url: "photos/photo (44).jpg", video: false },
            { url: "photos/photo (45).jpg", video: false },
            { url: "photos/photo (46).jpg", video: false },
            { url: "photos/photo (47).jpg", video: false },
            { url: "photos/photo (48).jpg", video: false },
            { url: "photos/photo (49).jpg", video: false },
            { url: "photos/photo (50).jpg", video: false },

            { url: "photos/photo (51).jpg", video: false },
            { url: "photos/photo (52).jpg", video: false },
            { url: "photos/photo (53).jpg", video: false },
            { url: "photos/photo (54).jpg", video: false },
            { url: "photos/photo (55).jpg", video: false },
            { url: "photos/photo (56).jpg", video: false },
            { url: "photos/photo (57).jpg", video: false },
            { url: "photos/photo (58).jpg", video: false },
            { url: "photos/photo (59).jpg", video: false },
            { url: "photos/photo (60).jpg", video: false },

            { url: "photos/photo (61).jpg", video: false },
            { url: "photos/photo (62).jpg", video: false },
            { url: "photos/photo (63).jpg", video: false },
            { url: "photos/photo (64).jpg", video: false },
            { url: "photos/photo (65).jpg", video: false },
            { url: "photos/photo (66).jpg", video: false },
            { url: `https://videos.pexels.com/video-files/3571264/3571264-sd_640_360_30fps.mp4`, video: true },
            { url: `https://videos.pexels.com/video-files/2491284/2491284-sd_640_360_30fps.mp4`, video: true },
            { url: `https://videos.pexels.com/video-files/3044127/3044127-sd_640_360_30fps.mp4`, video: true }
        ];

        remaining = mediaSources.length + 1;

        function fireworks() {
            fwSound.currentTime = 0;
            fwSound.play();
            for (let i = 0; i < 160; i++) {
                const s = document.createElement('div');
                s.className = 'spark';
                s.style.left = Math.random() * 100 + '%';
                s.style.top = Math.random() * 100 + '%';
                s.style.setProperty('--dx', (Math.random() * 1000 - 500) + 'px');
                s.style.setProperty('--dy', (Math.random() * -800) + 'px');
                document.getElementById('fireworks').appendChild(s);
                setTimeout(() => s.remove(), 1600);
            }
        }

        function openMedia(el, src, isVideo) {
            if (!unlocked && el.id !== 'hero') return;

            tap.currentTime = 0;
            tap.play();

            overlayContent.querySelectorAll('img,video').forEach(e => e.remove());

            // Reset animation by forcing reflow
            overlay.style.display = 'flex';
            overlayContent.style.animation = 'none';
            overlayContent.offsetHeight; // trigger reflow
            overlayContent.style.animation = '';

            const m = isVideo ? document.createElement('video') : document.createElement('img');
            m.src = src;
            if (isVideo) {
                m.controls = true;
                m.autoplay = true;
                bgm.pause();
            }
            overlayContent.appendChild(m);

            closeBtn.onclick = () => {
                overlay.style.display = 'none';
                el.remove();
                remaining--;
                if (isVideo) {
                    bgm.play();
                }
                if (remaining === 0) {
                    refreshBtn.style.display = 'block';
                    tapHint.remove();
                }
            };
        }

        // Create all media tiles (but don't animate yet)
        mediaSources.forEach((item, i) => {
            const d = document.createElement('div');
            d.className = 'media';
            const [x, y] = pilePositions[i];
            d.style.setProperty('--x', x + '%');
            d.style.setProperty('--y', y + '%');

            const el = item.video ? document.createElement('video') : document.createElement('img');
            el.src = item.url;
            if (item.video) el.muted = true;
            d.appendChild(el);
            d.onclick = () => openMedia(d, item.url, item.video);
            stage.appendChild(d);
        });

        // Create hero
        const hero = document.createElement('div');
        hero.id = 'hero';
        hero.innerHTML = '<img src="https://images.unsplash.com/photo-1511988617509-a57c8a288659?w=600">';
        hero.onclick = () => {
            openMedia(hero, hero.querySelector('img').src, false);
            unlocked = true;

            // Remove blur from all media
            document.querySelectorAll('.media').forEach(m => {
                m.classList.add('unlocked');
                m.style.pointerEvents = 'auto';
            });

            // Hide tap hint
            tapHint.classList.remove('show');
            tapHint.style.opacity = '0';

            bgm.volume = 0.55;
            bgm.play();
        };
        stage.appendChild(hero);

        // Create caption
        const caption = document.createElement('div');
        caption.id = 'caption';
        caption.textContent = 'ХЕПІ БЬОЗДЕЙ!';
        stage.appendChild(caption);

        // TAP OVERLAY - starts everything
        tapOverlay.addEventListener('click', () => {
            if (started) return;
            started = true;

            // Unlock all audio
            [bgm, tap, fallSound, fwSound].forEach(a => {
                a.volume = 0.7;
                a.play().then(() => a.pause()).catch(() => { });
            });

            // Remove tap overlay
            tapOverlay.style.display = 'none';

            // Start falling animations with individual sounds
            let delay = 0;
            document.querySelectorAll('.media').forEach((d, index) => {
                d.style.animationDelay = delay + 's';
                d.classList.add('animate');

                // Each tile plays fall sound when it LANDS (after delay + 1400ms animation)
                setTimeout(() => {
                    const fall = new Audio('fall.mp3');
                    fall.volume = 0.7;
                    fall.play();
                }, (delay + 0.05) * 1000);

                delay += 0.3;
            });

            // Total media falling time
            const mediaFallDuration = 9 + 1.2;

            // Hero starts immediately
            hero.classList.add('animate');

            // Show tap hint after hero lands (1600ms)
            setTimeout(() => {
                tapHint.classList.add('show');
            }, 10600);

            // Caption falls ONLY AFTER all media elements finished
            setTimeout(() => {
                caption.classList.add('animate');

                // Fireworks trigger when caption lands (900ms after caption starts)
                setTimeout(() => {
                    fireworks();
                    bg.style.opacity = 1;
                }, 900);
            }, mediaFallDuration * 1000);
        });

        refreshBtn.onclick = () => location.reload();
    </script>
</body>

</html>